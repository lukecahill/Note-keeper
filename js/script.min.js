(function(){var t=false;var e=$("#note-list");var o=$("#complete-notes-button");var n=$("#show-all-notes-button");var a=$("#new-note-section");var i=$("#tag-chooser");var c=$("#add-note-tags");var s={userId:userId,complete:0,action:"loadnote"};l(s);function l(t){$.ajax({url:"includes/load-note.php",method:"POST",data:t,action:"loadnote"}).done(function(n,a){if(a==="success"){if(t.action==="searchnote"){e.empty()}n=$.parseJSON(n);if(n!=="none"){$.each(n[0],function(t,e){c.append('<div class="checkbox"><label><input type="checkbox" name="new-tag" data-tag="'+e+'" value="'+e+'">'+e+"</label></div>")});i.empty();i.append($("<option></option>").attr("disabled",true).attr("selected",true).text("-- Choose a tag --"));i.append($("<option></option>").attr("value","showall").text("-- Show all --"));$.each(n[1],function(t,e){i.append($("<option></option>").attr("value",e).attr("data-tag",e).text(e))});e.append(n[2]);e.after(n[3])}else{e.append("It appears that you have not yet created any notes. Create your first one.")}if(t.complete!==1){o.html('<span class="glyphicon glyphicon-asterisk"></span>	Show Completed Notes')}else{o.html('<span class="glyphicon glyphicon-asterisk"></span>	Show Active Notes')}}}).fail(function(t){console.log("It failed: ",t)})}function d(t){var e={userId:userId,complete:0,action:"searchnote",search:t};l(e)}function h(t,e,o){var n=$(e).val();if(n.trim()!==""){if(o){$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="'+n+'" value="'+n+'">'+n+"</label></div>")}else{$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="'+n+'" value="'+n+'">'+n+"</label></div>")}$(e).val("")}}function r(t){var e=$(".note");var o=[];$(".note").show();$.each(e,function(e,n){$value=$(n);var a=$value.children(".note-tags");var i=[];$.each(a,function(t,e){$this=$(e);var o=$this.data("tag");i.push(o)});if(i.indexOf(t)===-1){o.push(n)}});$.each(o,function(t,e){$(e).hide()});toastr.info('Now only showing notes with the tag "'+t+'"')}toastr.options={timeOut:"2000",preventDuplicates:false,closeButton:true};a.hide();$(".note-text-validation, .edit-note-text-validation, #seach-input").hide();$("#new-note-button").on("click",function(){a.toggle()});n.on("click",function(){$(".note").show()});$("#add-note-button").on("click",function(){var t=$("#add-note-text").val();var o=$("#add-note-title").val();var n=[];if(t.trim()===""){$(".note-text-validation").show();return}$("input:checkbox[name=new-tag]:checked").each(function(){n.push($(this).val())});$.ajax({url:"includes/note.php",method:"POST",data:{noteText:t,noteTags:n,noteTitle:o,userId:userId,action:"addnote"}}).done(function(i,c){var s="";$.each(n,function(t,e){s+='<span class="note-tags" title="Click to show all notes with this tag." data-tag="'+e+'">'+e+"</span>"});e.append('<div class="note" data-id="'+i+'"><span class="note-id" id="'+i+'">Note ID: '+i+'</span><h4 class="note-title">'+o+'</h4><p class="note-text">'+t+"</p>"+s+'<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span><span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div></div>');$("#add-note-title").val("");$("#add-note-text").val("");$("input:checkbox[name=new-tag]").removeAttr("checked");tagsToAdd=[];toastr.success("Note has been added successfully!");a.hide()}).fail(function(t){console.log("There was a failure: ",t)})});$("#show-new-tag-button").on("click",function(){h("#add-note-tags","#add-new-tag-text",false)});$("#edit-new-tag-button").on("click",function(){h("#edit-note-tags","#edit-new-tag-text",true)});e.on("click",".note-tags",function(){var t=$(this).data("tag");r(t)});e.on("click",".remove-note",function(){if(!confirm("Are you sure you wish to remove this note?")){return}$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/note.php",data:{deleteNote:t,action:"deletenote"}}).done(function(t,e){$this.closest(".note").remove();toastr.success("Note has been deleted!")}).fail(function(t){console.log("An error has occurred: ",t)})});e.on("click",".edit-note",function(){$this=$(this);var t=$this.closest(".note").data("id");$("#save-note-button").data("id",t);var e=$this.closest(".note");var o=$(e);var n=o.find(".note-title")[0].textContent;var a=o.find(".note-text")[0].textContent;var i=o.find(".note-tags");var c=[];$.each(i,function(t,e){c.push(e.textContent)});$("#note-edit-modal").modal("show");$("#edit-note-tags").empty();$("#edit-note-title").val(n);$("#edit-note-text").val(a);$.each(c,function(t,e){$("#edit-note-tags").append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="'+e+'" value="'+e+'">'+e+"</label></div>")})});e.on("click",".note-done",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/note-done.php",data:{noteId:t,complete:1}}).done(function(t,e){$this.closest(".note").remove();toastr.success("Note marked as complete!")}).fail(function(t){console.log("An error has occurred: ",t)})});o.on("click",function(){var o={userId:userId,complete:0,action:"loadnote"};if(t){e.empty();t=false;o.complete=0;l(o)}else{e.empty();t=true;o.complete=1;l(o)}});e.on("click",".mark-note-active",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/note-done.php",data:{noteId:t,complete:0}}).done(function(t,e){$this.closest(".note").remove();toastr.success("Note marked as active!")}).fail(function(t){console.log("An error has occurred: ",t)})});$("#save-note-button").on("click",function(){var t=$("#edit-note-title").val();var e=$("#edit-note-text").val();var o=[];var n=$("#save-note-button").data("id");$("input:checkbox[name=edit-tag]:checked").each(function(){o.push($(this).val())});$.ajax({method:"POST",url:"includes/note.php",data:{noteText:e,noteId:n,noteTitle:t,noteTags:o,action:"editnote"}}).done(function(a,i){var c=$('[data-id="'+n+'"]');$(c).children(".note-title")[0].textContent=t;$(c).children(".note-text")[0].textContent=e;var s=$(c).children(".note-text")[0];$(c).children(".note-tags").remove();var l="";$.each(o,function(t,e){l+='<span class="note-tags" title="Click to show all notes with this tag." data-tag="'+e+'">'+e+"</span>"});$(s).after(l);$("#note-edit-modal").modal("hide");toastr.success("Note successfully updated!")}).fail(function(t){console.log("An error has occurred: ",t)})});$("#tag-chooser").on("change",function(){var t=this.value;if(t!=="showall"){r(this.value)}else{$(".note").show();toastr.info("Showing all notes")}});$("#search-note-button").on("click",function(){var t=$("#search-note-text").val();d(t)});$("#show-search-button").on("click",function(){$("#seach-input").toggle();i.toggle();$("label[for=tag-chooser").toggle()});e.on("click","#note-edit-modal",function(){$("#note-edit-modal").show()});$("#close-new-note").on("click",function(){a.hide()});$("#add-note-text").on("keyup",function(){$(".note-text-validation").hide()});$("#edit-note-text").on("keyup",function(){$(".edit-note-text-validation").hide()});$("#add-new-tag-text").on("keyup",function(t){if(t.keyCode==13){h("#add-note-tags","#add-new-tag-text",false)}});$("#edit-new-tag-text").on("keyup",function(t){if(t.keyCode==13){h("#edit-note-tags","#edit-new-tag-text",true)}});$("#refresh-button").on("click",function(){e.empty();$(".checkbox").remove();l(s)})})();