(function(){var t=false;var e=$("#note-list");var n=$("#complete-notes-button");var o=$("#show-all-notes-button");var a=$("#new-note-section");var i=$("#tag-chooser");var s=$("#add-note-tags");var c={userId:userId,complete:0,action:"loadnote"};l(c);function l(t){$.ajax({url:"includes/load-note.php",method:"POST",data:t,action:"loadnote"}).done(function(o,a){if(a==="success"){if(t.action==="searchnote"){e.empty()}o=$.parseJSON(o);if(o!=="none"){$.each(o[0],function(t,e){s.append('<div class="checkbox"><label><input type="checkbox" name="new-tag" data-tag="'+e+'" value="'+e+'">'+e+"</label></div>")});i.empty();i.append($("<option></option>").attr("disabled",true).attr("selected",true).text("-- Choose a tag --"));i.append($("<option></option>").attr("value","showall").text("-- Show all --"));$.each(o[1],function(t,e){i.append($("<option></option>").attr("value",e).attr("data-tag",e).text(e))});u(o[2]);e.after(o[3])}else{e.append("It appears that you have not yet created any notes. Create your first one.")}if(t.complete!==1){n.html('<span class="glyphicon glyphicon-asterisk"></span>	Show Completed Notes')}else{n.html('<span class="glyphicon glyphicon-asterisk"></span>	Show Active Notes')}}}).fail(function(t){console.log("It failed: ",t)})}function d(t){var e={userId:userId,complete:0,action:"searchnote",search:t};l(e)}function h(t,e,n){var o=$(e).val();if(o.trim()!==""){if(n){$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="'+o+'" value="'+o+'">'+o+"</label></div>")}else{$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="'+o+'" value="'+o+'">'+o+"</label></div>")}$(e).val("")}}function r(t){var e=$(".note");var n=[];$(".note").show();$.each(e,function(e,o){$value=$(o);var a=$value.children(".note-tags");var i=[];$.each(a,function(t,e){$this=$(e);var n=$this.data("tag");i.push(n)});if(i.indexOf(t)===-1){n.push(o)}});$.each(n,function(t,e){$(e).hide()});toastr.info('Now only showing notes with the tag "'+t+'"')}function u(t){$.each(t,function(n,o){var a='<div class="note" data-id="'+o.id+'"><span class="note-id" id="'+o.id+'">Note ID: '+o.id+"</span>";a+='<h4 class="note-title">'+o.title+'</h4><p class="note-text">'+o.text+"</p>";$.each(t[0][0],function(t,e){a+='<span class="note-tags note-tags note-tags-'+o.color+'" title="Click to show all notes with this tag." data-tag="'+e+'">'+e+"</span>"});if(o.complete==="0"){a+='<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>';a+='<span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div>'}else{a+='<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>';a+='<span class="glyphicon glyphicon-asterisk mark-note-active" title="Mark as active"></span></div>'}e.append(a)})}toastr.options={timeOut:"2000",preventDuplicates:false,closeButton:true};a.hide();$(".note-text-validation, .edit-note-text-validation, #seach-input").hide();$("#new-note-button").on("click",function(){a.toggle()});o.on("click",function(){$(".note").show()});$("#add-note-button").on("click",function(){var t=$("#add-note-text").val();var n=$("#add-note-title").val();var o=[];if(t.trim()===""){$(".note-text-validation").show();return}$("input:checkbox[name=new-tag]:checked").each(function(){o.push($(this).val())});$.ajax({url:"includes/note.php",method:"POST",data:{noteText:t,noteTags:o,noteTitle:n,userId:userId,action:"addnote"}}).done(function(i,s){var c="";$.each(o,function(t,e){c+='<span class="note-tags" title="Click to show all notes with this tag." data-tag="'+e+'">'+e+"</span>"});e.append('<div class="note" data-id="'+i+'"><span class="note-id" id="'+i+'">Note ID: '+i+'</span><h4 class="note-title">'+n+'</h4><p class="note-text">'+t+"</p>"+c+'<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span><span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div></div>');$("#add-note-title").val("");$("#add-note-text").val("");$("input:checkbox[name=new-tag]").removeAttr("checked");tagsToAdd=[];toastr.success("Note has been added successfully!");a.hide()}).fail(function(t){console.log("There was a failure: ",t)})});$("#show-new-tag-button").on("click",function(){h("#add-note-tags","#add-new-tag-text",false)});$("#edit-new-tag-button").on("click",function(){h("#edit-note-tags","#edit-new-tag-text",true)});e.on("click",".note-tags",function(){var t=$(this).data("tag");r(t)});e.on("click",".remove-note",function(){if(!confirm("Are you sure you wish to remove this note?")){return}$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/note.php",data:{deleteNote:t,action:"deletenote"}}).done(function(t,e){$this.closest(".note").remove();toastr.success("Note has been deleted!")}).fail(function(t){console.log("An error has occurred: ",t)})});e.on("click",".edit-note",function(){$this=$(this);var t=$this.closest(".note").data("id");$("#save-note-button").data("id",t);var e=$this.closest(".note");var n=$(e);var o=n.find(".note-title")[0].textContent;var a=n.find(".note-text")[0].textContent;var i=n.find(".note-tags");var s=[];$.each(i,function(t,e){s.push(e.textContent)});$("#note-edit-modal").modal("show");$("#edit-note-tags").empty();$("#edit-note-title").val(o);$("#edit-note-text").val(a);$.each(s,function(t,e){$("#edit-note-tags").append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="'+e+'" value="'+e+'">'+e+"</label></div>")})});e.on("click",".note-done",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/note-done.php",data:{noteId:t,complete:1}}).done(function(t,e){$this.closest(".note").remove();toastr.success("Note marked as complete!")}).fail(function(t){console.log("An error has occurred: ",t)})});n.on("click",function(){var n={userId:userId,complete:0,action:"loadnote"};if(t){e.empty();t=false;n.complete=0;l(n)}else{e.empty();t=true;n.complete=1;l(n)}});e.on("click",".mark-note-active",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/note-done.php",data:{noteId:t,complete:0}}).done(function(t,e){$this.closest(".note").remove();toastr.success("Note marked as active!")}).fail(function(t){console.log("An error has occurred: ",t)})});$("#save-note-button").on("click",function(){var t=$("#edit-note-title").val();var e=$("#edit-note-text").val();var n=[];var o=$("#save-note-button").data("id");$("input:checkbox[name=edit-tag]:checked").each(function(){n.push($(this).val())});$.ajax({method:"POST",url:"includes/note.php",data:{noteText:e,noteId:o,noteTitle:t,noteTags:n,action:"editnote"}}).done(function(a,i){var s=$('[data-id="'+o+'"]');$(s).children(".note-title")[0].textContent=t;$(s).children(".note-text")[0].textContent=e;var c=$(s).children(".note-text")[0];$(s).children(".note-tags").remove();var l="";$.each(n,function(t,e){l+='<span class="note-tags" title="Click to show all notes with this tag." data-tag="'+e+'">'+e+"</span>"});$(c).after(l);$("#note-edit-modal").modal("hide");toastr.success("Note successfully updated!")}).fail(function(t){console.log("An error has occurred: ",t)})});$("#tag-chooser").on("change",function(){var t=this.value;if(t!=="showall"){r(this.value)}else{$(".note").show();toastr.info("Showing all notes")}});$("#search-note-button").on("click",function(){var t=$("#search-note-text").val();d(t)});$("#search-note-text").on("keyup",function(t){if(t.keyCode==13){var e=$("#search-note-text").val();d(e)}});$("#show-search-button").on("click",function(){$("#seach-input").toggle();i.toggle();$("label[for=tag-chooser").toggle()});e.on("click","#note-edit-modal",function(){$("#note-edit-modal").show()});$("#close-new-note").on("click",function(){a.hide()});$("#add-note-text").on("keyup",function(){$(".note-text-validation").hide()});$("#edit-note-text").on("keyup",function(){$(".edit-note-text-validation").hide()});$("#add-new-tag-text").on("keyup",function(t){if(t.keyCode==13){h("#add-note-tags","#add-new-tag-text",false)}});$("#edit-new-tag-text").on("keyup",function(t){if(t.keyCode==13){h("#edit-note-tags","#edit-new-tag-text",true)}});$("#refresh-button").on("click",function(){e.empty();$(".checkbox").remove();l(c)})})();