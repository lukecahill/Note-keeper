!function(){function t(t){$.ajax({url:"includes/LoadNote.php",method:"POST",data:t,action:"loadnote"}).done(function(o,n){e(o,n,t)}).fail(function(t){console.log("It failed: ",t)})}function e(t,e,o){"success"===e&&("searchnote"===o.action&&s.empty(),t=JSON.parse(t),"none"!==t&&"no_results"!==t?($("#no-results").remove(),0===o.complete&&(r.empty(),$.each(t[0],function(t,e){r.append('<div class="checkbox"><label><input type="checkbox" name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(e))})),h.empty(),h.append($("<option></option>").attr("value","showall").attr("selected",!0).text("-- Show all --")),$.each(t[1],function(t,e){h.append($("<option></option>").attr("value",e).attr("data-tag",e).text(e)),p.push(e)}),i(t[2]),u=t[3]):"no_results"===t?s.append('<p id="no-results">No note with that search could be found!</p>'):s.append('<p id="first-note">It appears that you have not yet created any notes. Create your first one.</p>'))}function o(e){var o={userId:userId,action:"searchnote",search:e,auth:auth};t(o)}function n(t,e,o){var n=$(e).val();""!==n.trim()&&(1===o?$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(n)):0===o?$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(n)):2===o&&$(t).append('<div class="checkbox new-note-checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(n)),$(e).val(""))}function a(t){var e=$(".note"),o=[];$(".note").show(),t=t.toLowerCase(),$.each(e,function(e,n){$value=$(n);var a=$value.find(".note-tags"),i=[];$.each(a,function(t,e){$this=$(e);var o=$this.data("tag");i.push(o.toLowerCase())}),i.indexOf(t)===-1&&o.push(n)}),$.each(o,function(t,e){$(e).hide()}),toastr.info('Showing all notes with the tag "{0}"'.format(t))}function i(t){var e="";$.each(t,function(o,n){e='<div class="note" data-id="{0}">'.format(n.id),e+='<h4 class="note-title">{0}</h4><p class="note-text">{1}</p>'.format(n.title,n.text),t[o][0].length>0&&(e+='<div class="tag-container">',$.each(t[o][0],function(t,o){e+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(n.color,o)}),e+="</div>"),"0"==n.complete?(e+=t[o][0].length>0?'<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>':'<div class="note-glyphicons note-glyphicons-empty"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>',e+='<span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div>'):(e+='<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>',e+='<span class="glyphicon glyphicon-asterisk mark-note-active" title="Mark as active"></span></div>'),s.append(e)})}var c=!1,s=$("#note-list"),l=$("#complete-notes-button"),d=$("#new-note-section"),h=$("#tag-chooser"),r=$("#add-note-tags"),u="red",p=[];"undefined"!=typeof toastr&&(toastr.options={timeOut:"2000",preventDuplicates:!1,closeButton:!0});var g={userId:userId,complete:0,action:"loadnote",auth:auth};t(g),String.prototype.format||(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,o){return"undefined"!=typeof t[o]?t[o]:e})}),"light"===localStorage.getItem("theme")?($("html").removeClass("dark-theme"),$(".container-fluid.account-dark").removeClass("account-dark")):"dark"===localStorage.getItem("theme")&&($("html").addClass("dark-theme"),$(".container-fluid.account-dark").addClass("account-dark")),$(".note-text-validation, .edit-note-text-validation, #search-input, #tag-chooser-input").hide(),d.hide(),$("#new-note-button").on("click",function(){d.toggle()}),$("#add-note-button").on("click",function(){var t=$("#add-note-text").val(),e=$("#add-note-title").val(),o=[];return""===t.trim()&&""===e.trim()?void $(".note-text-validation").show():($("input:checkbox[name=new-tag]:checked").each(function(){o.push($(this).val())}),void $.ajax({url:"includes/NoteApi.php",method:"POST",data:{noteText:t,noteTags:o,noteTitle:e,userId:userId,action:"addnote"}}).done(function(n,a){if(n=JSON.parse(n),1==n[0]){var i="";$.each(o,function(t,e){i+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(u,e),p.indexOf(e)===-1&&(p.push(e),h.append($("<option></option>").attr("value",e).attr("data-tag",e).text(e)))}),t=t.replace(/\n/g,"<br>"),s.append('<div class="note" data-id="{0}"><h4 class="note-title">{1}</h4><p class="note-text">{2}</p>{3}<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span><span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div></div>'.format(n[1],e,t,i)),$("#add-note-title").val(""),$("#add-note-text").val(""),$("input:checkbox[name=new-tag]").removeAttr("checked"),$(".new-note-checkbox").remove(),$("#first-note").remove(),tagsToAdd=[],toastr.success("Note has been added successfully!"),d.hide()}else alert("Something went wrong! Check the console for more"),console.log(n)}).fail(function(t){console.log("There was a failure: ",t)}))}),$("#show-new-tag-button").on("click",function(){n("#add-note-tags","#add-new-tag-text",2)}),$("#edit-new-tag-button").on("click",function(){n("#edit-note-tags","#edit-new-tag-text",1)}),s.on("click",".note-tags",function(){var t=$(this).data("tag");a(t)}),s.on("click",".remove-note",function(){if(confirm("Are you sure you wish to remove this note?")){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,action:"deletenote"}}).done(function(t,e){$this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note has been deleted!")}).fail(function(t){console.log("An error has occurred: ",t)})}}),s.on("click",".edit-note",function(){$this=$(this);var t=$this.closest(".note").data("id");$("#save-note-button").data("id",t);var e=$this.closest(".note"),o=$(e),n=o.find(".note-title")[0].textContent,a=o.find(".note-text")[0].textContent,i=o.find(".note-tags"),c=[];$.each(i,function(t,e){c.push(e.textContent)}),$("#note-edit-modal").modal("show"),$("#edit-note-tags").empty(),$("#edit-note-title").val(n),$("#edit-note-text").val(a),$.each(c,function(t,e){$("#edit-note-tags").append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(e))})}),s.on("click",".note-done",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,complete:1,action:"setcomplete"}}).done(function(t,e){1==t?($this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note marked as complete!")):(alert("Something went wrong! Check the console for more"),console.log(t))}).fail(function(t){console.log("An error has occurred: ",t)})}),l.on("click",function(){var e={userId:userId,complete:0,action:"loadnote",auth:auth};c?(s.empty(),c=!1,e.complete=0,t(e)):(s.empty(),c=!0,e.complete=1,t(e))}),s.on("click",".mark-note-active",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,complete:0,action:"setcomplete"}}).done(function(t,e){1==t?($this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note marked as active!")):(alert("Something went wrong! Check the console for more"),console.log(t))}).fail(function(t){console.log("An error has occurred: ",t)})}),$("#save-note-button").on("click",function(){var t=$("#edit-note-title").val(),e=$("#edit-note-text").val(),o=[],n=$("#save-note-button").data("id");$("input:checkbox[name=edit-tag]:checked").each(function(){o.push($(this).val())}),$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteText:e,noteId:n,noteTitle:t,noteTags:o,action:"editnote"}}).done(function(a,i){if(1==a){var c=$('[data-id="'+n+'"]');$(c).children(".note-title")[0].textContent=t,$(c).children(".note-text")[0].textContent=e;var s=$(c).children(".note-text")[0];$(c).find(".note-tags").remove();var l="";$.each(o,function(t,e){l+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(u,e)}),$(s).after(l),$("#note-edit-modal").modal("hide"),toastr.success("Note successfully updated!")}else alert("Something went wrong! Check the console for more"),console.log(a)}).fail(function(t){console.log("An error has occurred: ",t)})}),$("#tag-chooser").on("change",function(){var t=this.value;"showall"!==t?a(this.value):($(".note").show(),toastr.info("Showing all notes"))}),$("#search-note-button").on("click",function(){var t=$("#search-note-text").val();o(t)}),$("#search-note-text").on("keyup",function(t){if(13==t.keyCode){var e=$("#search-note-text").val();o(e)}}),$("#show-search-button").on("click",function(){$("#search-input").toggle(),$("#tag-chooser-input").hide()}),$("#show-tag-chooser-button").on("click",function(){$("#search-input").hide(),$("#tag-chooser-input").toggle()}),s.on("click","#note-edit-modal",function(){$("#note-edit-modal").show()}),$("#close-new-note").on("click",function(){d.hide()}),$("#add-note-text").on("keyup",function(){$(".note-text-validation").hide()}),$("#edit-note-text").on("keyup",function(){$(".edit-note-text-validation").hide()}),$("#add-new-tag-text").on("keyup",function(t){13==t.keyCode&&n("#add-note-tags","#add-new-tag-text",2)}),$("#edit-new-tag-text").on("keyup",function(t){13==t.keyCode&&n("#edit-note-tags","#edit-new-tag-text",1)}),$("#refresh-button").on("click",function(){s.empty(),$(".checkbox").remove(),t(g)})}();