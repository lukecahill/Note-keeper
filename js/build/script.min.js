!function(){function t(){if(!localStorageTest())return void console.log("localStorage is not supported.");var t=localStorage.getItem("notification");$.ajax({method:"POST",url:"includes/Notifications.php",data:{last:t,id:userId,action:"check"}}).done(function(n,o){n=JSON.parse(n),"none_found"!==n&&n>t&&(e(t),f.show())}).fail(function(t){console.log(t)})}function e(t){$.ajax({method:"POST",url:"includes/Notifications.php",data:{last:t,id:userId,action:"get"}}).done(function(t,e){console.log(t,e)}).fail(function(t){console.log(t)})}function n(t){$.ajax({url:"includes/LoadNote.php",method:"POST",data:t,action:"loadnote"}).done(function(e,n){o(e,n,t)}).fail(function(t){console.log("It failed: ",t)})}function o(t,e,n){"success"===e&&("searchnote"===n.action&&(d.innerHTML=""),t=JSON.parse(t),"none"!==t&&"no_results"!==t?($("#no-results").remove(),0===n.complete&&(p.innerHTML="",t[0].forEach(function(t,e){p.append('<div class="checkbox"><label><input type="checkbox" name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(t))})),h.innerHTML="",h.append($("<option></option>").attr("value","note_keeper_showall").attr("selected",!0).text("-- Show all --")),t[1].forEach(function(t,e){h.append($("<option></option>").attr("value",t).attr("data-tag",t).text(t)),m.push(t)}),s(t[2]),g=t[3]):"no_results"===t?d.append('<p id="no-results">No note with that search could be found!</p>'):d.append('<p id="first-note">It appears that you have not yet created any notes. Create your first one.</p>'))}function a(t){var e={userId:userId,action:"searchnote",search:t,auth:auth};n(e)}function i(t,e,n){var o=$(e).val();""!==o.trim()&&(1===n?$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(o)):0===n?$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(o)):2===n&&$(t).append('<div class="checkbox new-note-checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(o)),$(e).val(""))}function c(t){var e=$(".note"),n=[];$(".note").show(),t=t.toLowerCase(),$.each(e,function(e,o){$value=$(o);var a=$value.find(".note-tags"),i=[];$.each(a,function(t,e){$this=$(e);var n=$this.data("tag");i.push(n.toLowerCase())}),i.indexOf(t)===-1&&n.push(o)}),n.forEach(function(t,e){$(t).hide()}),toastr.info('Showing all notes with the tag "{0}"'.format(t))}function s(t){var e="";t.forEach(function(n,o){e='<div class="note" data-id="{0}">'.format(n.id),e+='<h4 class="note-title">{0}</h4><p class="note-text">{1}</p>'.format(n.title,n.text),t[o][0].length>0&&(e+='<div class="tag-container"><span class="glyphicon glyphicon-tag glyph-tag-lower"></span>',t[o][0].forEach(function(t,o){e+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(n.color,t)}),e+="</div>"),"0"===n.complete?(e+=t[o][0].length>0?'<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>':'<div class="note-glyphicons note-glyphicons-empty"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>',e+='<span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div>'):(e+='<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>',e+='<span class="glyphicon glyphicon-asterisk mark-note-active" title="Mark as active"></span></div>'),d.append(e)})}var l=!1,d=$("#note-list"),r=$("#complete-notes-button"),u=$("#new-note-section"),h=$("#tag-chooser"),p=$("#add-note-tags"),g="",m=[],f=$("#system-notification-group");"undefined"!=typeof toastr&&(toastr.options={timeOut:"2000",preventDuplicates:!1,closeButton:!0});var v={userId:userId,complete:0,action:"loadnote",auth:auth};n(v),t(),localStorageTest()&&("light"===localStorage.getItem("theme")?($("html").removeClass("dark-theme"),$(".container-fluid.account-dark").removeClass("account-dark")):"dark"===localStorage.getItem("theme")&&($("html").addClass("dark-theme"),$(".container-fluid.account-dark").addClass("account-dark"))),$(".note-text-validation, .edit-note-text-validation, #search-input, #tag-chooser-input").hide(),u.hide(),document.getElementById("new-note-button").addEventListener("click",function(){u.toggle()}),document.getElementById("add-note-button").addEventListener("click",function(){var t=document.getElementById("add-note-text").value,e=document.getElementById("add-note-title").value,n=[];return""===t.trim()&&""===e.trim()?void $(".note-text-validation").show():($("input:checkbox[name=new-tag]:checked").each(function(){n.push($(this).val())}),document.getElementById("add-note-button").disabled=!0,void $.ajax({url:"includes/NoteApi.php",method:"POST",data:{noteText:t,noteTags:n,noteTitle:e,userId:userId,action:"addnote"}}).done(function(o,a){if(o=JSON.parse(o),o[0]===!0){var i="";if($.each(n,function(t,e){i+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(g,e),m.indexOf(e)===-1&&(m.push(e),h.append($("<option></option>").attr("value",e).attr("data-tag",e).text(e)))}),t=t.replace(/\n/g,"<br>"),d.append('<div class="note" data-id="{0}"><h4 class="note-title">{1}</h4><p class="note-text">{2}</p><div class="tag-container"><span class="glyphicon glyphicon-tag glyph-tag-lower"></span>{3}</div><div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span><span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div></div>'.format(o[1],e,t,i)),document.getElementById("add-note-title").value="",document.getElementById("add-note-text").value="",$("input:checkbox[name=new-tag]").removeAttr("checked"),$(".new-note-checkbox").remove(),document.getElementById("first-note")){var c=document.getElementById("first-note");c.parentNode.removeChild(c)}tagsToAdd=[],document.getElementById("add-note-button").disabled=!1,toastr.success("Note has been added successfully!"),u.hide()}else alert("Something went wrong! Check the console for more"),console.log(o)}).fail(function(t){console.log("There was a failure: ",t)}))}),document.getElementById("show-new-tag-button").addEventListener("click",function(){i("#add-note-tags","#add-new-tag-text",2)}),document.getElementById("edit-new-tag-button").addEventListener("click",function(){i("#edit-note-tags","#edit-new-tag-text",1)}),d.on("click",".note-tags",function(){var t=this.dataset.tag;c(t)}),document.getElementById("note-list").addEventListener("click",function(t){if(t.target&&t.target.matches(".remove-note")){if(!confirm("Are you sure you wish to remove this note?"))return;$this=$(this);var e=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:e,action:"deletenote"}}).done(function(t,e){$this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note has been deleted!")}).fail(function(t){console.log("An error has occurred: ",t)})}}),d.on("click",".edit-note",function(){$this=$(this);var t=$this.closest(".note").data("id");document.getElementById("save-note-button").setAttribute("data-id",t);var e=$this.closest(".note"),n=$(e),o=n.find(".note-title")[0].textContent,a=n.find(".note-text")[0].textContent,i=n.find(".note-tags"),c=[];$.each(i,function(t,e){c.push(e.textContent)}),$("#note-edit-modal").modal("show"),$("#edit-note-tags").innerHTML="",document.getElementById("edit-note-title").value=o,document.getElementById("edit-note-text").value=a,c.forEach(function(t,e){$("#edit-note-tags").append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(t))})}),d.on("click",".note-done",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,complete:1,action:"setcomplete"}}).done(function(t,e){1==t?($this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note marked as complete!")):(alert("Something went wrong! Check the console for more"),console.log(t))}).fail(function(t){console.log("An error has occurred: ",t)})}),r.on("click",function(){var t={userId:userId,complete:0,action:"loadnote",auth:auth};l?(d.innerHTML="",l=!1,t.complete=0,n(t)):(d.innerHTML="",l=!0,t.complete=1,n(t))}),d.on("click",".mark-note-active",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,complete:0,action:"setcomplete"}}).done(function(t,e){"1"===t?($this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note marked as active!")):(alert("Something went wrong! Check the console for more"),console.log(t))}).fail(function(t){console.log("An error has occurred: ",t)})}),document.getElementById("save-note-button").addEventListener("click",function(){var t=document.getElementById("edit-note-title").value,e=document.getElementById("edit-note-text").value,n=[],o=document.getElementById("save-note-button").getAttribute("data-id");$("input:checkbox[name=edit-tag]:checked").each(function(){n.push($(this).val())}),$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteText:e,noteId:o,noteTitle:t,noteTags:n,action:"editnote"}}).done(function(a,i){if("1"===a){var c=$('[data-id="'+o+'"]');$(c).children(".note-title")[0].textContent=t,$(c).children(".note-text")[0].textContent=e;var s=$(c).children(".note-text")[0];$(c).find(".note-tags").remove();var l="";n.forEach(function(t,e){l+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(g,t)}),$(s).after(l),$("#note-edit-modal").modal("hide"),toastr.success("Note successfully updated!")}else alert("Something went wrong! Check the console for more"),console.log(a)}).fail(function(t){console.log("An error has occurred: ",t)})}),document.getElementById("tag-chooser").addEventListener("change",function(){var t=this.value;"note_keeper_showall"!==t?c(this.value):($(".note").show(),toastr.info("Showing all notes"))}),$("#search-note-button").on("click",function(){var t=document.getElementById("search-note-text").value;a(t)}),$("#search-note-text").on("keyup",function(t){if(13===t.keyCode){var e=document.getElementById("search-note-text").value;a(e)}}),$("#show-search-button").on("click",function(){document.getElementById("tag-chooser-input").style.display="none",$("#search-input").toggle()}),$("#show-tag-chooser-button").on("click",function(){document.getElementById("search-input").style.display="none",$("#tag-chooser-input").toggle()}),d.on("click","#note-edit-modal",function(){$("#note-edit-modal").show()}),$("#close-new-note").on("click",function(){u.hide()}),$("#notification-close").on("click",function(){$("#system-notification-group").hide()}),$("#add-note-text").on("keyup",function(){$(".note-text-validation").hide()}),$("#edit-note-text").on("keyup",function(){$(".edit-note-text-validation").hide()}),$("#add-new-tag-text").on("keyup",function(t){13===t.keyCode&&i("#add-note-tags","#add-new-tag-text",2)}),$("#edit-new-tag-text").on("keyup",function(t){13===t.keyCode&&i("#edit-note-tags","#edit-new-tag-text",1)}),$("#refresh-button").on("click",function(){document.getElementById("note-list").innerHTML="";for(var t=document.getElementsByClassName("checkbox"),e=t.length,o=0;o<e;o++){var a=t[0].parentNode;a.removeChild(t[0])}n(v)})}();