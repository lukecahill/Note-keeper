!function(){function t(){if(!localStorageTest())return void console.log("localStorage is not supported.");var t=localStorage.getItem("notification");$.ajax({method:"POST",url:"includes/Notifications.php",data:{last:t,id:userId,action:"check"}}).done(function(n,o){n=JSON.parse(n),"none_found"!==n&&n>t&&(e(t),y.show())}).fail(function(t){console.log(t)})}function e(t){$.ajax({method:"POST",url:"includes/Notifications.php",data:{last:t,id:userId,action:"get"}}).done(function(t,e){console.log(t,e),Notification.requestPermission().then(function(e){n(t,"Note Keeper","")})}).fail(function(t){console.log(t)})}function n(t,e,n){var o={body:t,icon:n};new Notification(e,o)}function o(t){switch(console.log(t),t){case"no_results":console.log("No results could be found");break;case"0":console.log(t);break;default:alert("Something went wrong! Check the console for more")}}function a(t){$.ajax({url:"includes/LoadNote.php",method:"POST",data:t,action:"loadnote"}).done(function(e,n){i(e,n,t)}).fail(function(t){o(t)})}function i(t,e,n){"success"===e&&("searchnote"===n.action&&(r.innerHTML=""),t=JSON.parse(t),"none"!==t&&"no_results"!==t?($("#no-results").remove(),0===n.complete&&(m.innerHTML="",t[0].forEach(function(t,e){m.append('<div class="checkbox"><label><input type="checkbox" name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(t))})),g.innerHTML="",g.append($("<option></option>").attr("value","note_keeper_showall").attr("selected",!0).text("-- Show all --")),t[1].forEach(function(t,e){g.append($("<option></option>").attr("value",t).attr("data-tag",t).text(t)),v.push(t)}),l(t[2]),f=t[3]):"no_results"===t?r.append('<p id="no-results">No note with that search could be found!</p>'):r.append('<p id="first-note">It appears that you have not yet created any notes. Create your first one.</p>'))}function c(t){var e={userId:userId,action:"searchnote",search:t,auth:auth};a(e)}function s(t,e,n){var o=$(e).val();""!==o.trim()&&(1===n?$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(o)):0===n?$(t).append('<div class="checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(o)):2===n&&$(t).append('<div class="checkbox new-note-checkbox"><label><input type="checkbox" checked name="new-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(o)),$(e).val(""))}function d(t){var e=$(".note"),n=[];$(".note").show(),t=t.toLowerCase(),$.each(e,function(e,o){$value=$(o);var a=$value.find(".note-tags"),i=[];$.each(a,function(t,e){$this=$(e);var n=$this.data("tag");i.push(n.toLowerCase())}),i.indexOf(t)===-1&&n.push(o)}),n.forEach(function(t,e){$(t).hide()}),toastr.info('Showing all notes with the tag "{0}"'.format(t))}function l(t){var e="";t.forEach(function(n,o){e='<div class="note" data-id="{0}">'.format(n.id),e+='<h4 class="note-title">{0}</h4><p class="note-text">{1}</p>'.format(n.title,n.text),t[o][0].length>0&&(e+='<div class="tag-container"><span class="glyphicon glyphicon-tag glyph-tag-lower"></span>',t[o][0].forEach(function(t,o){e+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(n.color,t)}),e+="</div>"),"0"===n.complete?(e+=t[o][0].length>0?'<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>':'<div class="note-glyphicons note-glyphicons-empty"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>',e+='<span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div>'):(e+='<div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span>',e+='<span class="glyphicon glyphicon-asterisk mark-note-active" title="Mark as active"></span></div>'),r.append(e)})}var u=!1,r=$("#note-list"),h=$("#complete-notes-button"),p=$("#new-note-section"),g=$("#tag-chooser"),m=$("#add-note-tags"),f="",v=[],y=$("#system-notification-group");"undefined"!=typeof toastr&&(toastr.options={timeOut:"2000",preventDuplicates:!1,closeButton:!0});var k={userId:userId,complete:0,action:"loadnote",auth:auth};a(k),t(),localStorageTest()&&("light"===localStorage.getItem("theme")?($("html").removeClass("dark-theme"),$(".container-fluid.account-dark").removeClass("account-dark")):"dark"===localStorage.getItem("theme")&&($("html").addClass("dark-theme"),$(".container-fluid.account-dark").addClass("account-dark"))),$(".note-text-validation, .edit-note-text-validation, #search-input, #tag-chooser-input").hide(),p.hide(),document.getElementById("new-note-button").addEventListener("click",function(){p.toggle()}),document.getElementById("add-note-button").addEventListener("click",function(){var t=document.getElementById("add-note-text").value,e=document.getElementById("add-note-title").value,n=[];return""===t.trim()&&""===e.trim()?void $(".note-text-validation").show():($("input:checkbox[name=new-tag]:checked").each(function(){n.push($(this).val())}),document.getElementById("add-note-button").disabled=!0,void $.ajax({url:"includes/NoteApi.php",method:"POST",data:{noteText:t,noteTags:n,noteTitle:e,userId:userId,action:"addnote"}}).done(function(a,i){if(a=JSON.parse(a),a[0]===!0){var c="";if($.each(n,function(t,e){c+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(f,e),v.indexOf(e)===-1&&(v.push(e),g.append($("<option></option>").attr("value",e).attr("data-tag",e).text(e)))}),t=t.replace(/\n/g,"<br>"),r.append('<div class="note" data-id="{0}"><h4 class="note-title">{1}</h4><p class="note-text">{2}</p><div class="tag-container"><span class="glyphicon glyphicon-tag glyph-tag-lower"></span>{3}</div><div class="note-glyphicons"><span class="glyphicon glyphicon-remove remove-note" title="Delete this note"></span><span class="glyphicon glyphicon-edit edit-note" title="Edit this note"></span><span class="glyphicon glyphicon-ok note-done" title="Mark as done"></span></div></div>'.format(a[1],e,t,c)),document.getElementById("add-note-title").value="",document.getElementById("add-note-text").value="",$("input:checkbox[name=new-tag]").removeAttr("checked"),$(".new-note-checkbox").remove(),document.getElementById("first-note")){var s=document.getElementById("first-note");s.parentNode.removeChild(s)}tagsToAdd=[],document.getElementById("add-note-button").disabled=!1,toastr.success("Note has been added successfully!"),p.hide()}else o(a)}).fail(function(t){o(t)}))}),document.getElementById("show-new-tag-button").addEventListener("click",function(){s("#add-note-tags","#add-new-tag-text",2)}),document.getElementById("edit-new-tag-button").addEventListener("click",function(){s("#edit-note-tags","#edit-new-tag-text",1)}),r.on("click",".note-tags",function(){var t=this.dataset.tag;d(t)}),document.getElementById("note-list").addEventListener("click",function(t){if(t.target&&t.target.matches(".remove-note")){if(!confirm("Are you sure you wish to remove this note?"))return;$this=$(this);var e=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:e,action:"deletenote"}}).done(function(t,e){$this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note has been deleted!")}).fail(function(t){o(t)})}}),r.on("click",".edit-note",function(){$this=$(this);var t=$this.closest(".note").data("id");document.getElementById("save-note-button").setAttribute("data-id",t);var e=$this.closest(".note"),n=$(e),o=n.find(".note-title")[0].textContent,a=n.find(".note-text")[0].textContent,i=n.find(".note-tags"),c=[];$.each(i,function(t,e){c.push(e.textContent)}),$("#note-edit-modal").modal("show"),$("#edit-note-tags").innerHTML="",document.getElementById("edit-note-title").value=o,document.getElementById("edit-note-text").value=a,c.forEach(function(t,e){$("#edit-note-tags").append('<div class="checkbox"><label><input type="checkbox" checked name="edit-tag" data-tag="{0}" value="{0}">{0}</label></div>'.format(t))})}),r.on("click",".note-done",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,complete:1,action:"setcomplete"}}).done(function(t,e){1==t?($this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note marked as complete!")):o(t)}).fail(function(t){o(t)})}),h.on("click",function(){var t={userId:userId,complete:0,action:"loadnote",auth:auth};u?(r.innerHTML="",u=!1,t.complete=0,a(t)):(r.innerHTML="",u=!0,t.complete=1,a(t))}),r.on("click",".mark-note-active",function(){$this=$(this);var t=$this.closest(".note").data("id");$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteId:t,complete:0,action:"setcomplete"}}).done(function(t,e){"1"===t?($this.closest(".note").fadeOut(500,function(){$this.closest(".note").remove()}),toastr.success("Note marked as active!")):(o(t),console.log(t))}).fail(function(t){o(t)})}),document.getElementById("save-note-button").addEventListener("click",function(){var t=document.getElementById("edit-note-title").value,e=document.getElementById("edit-note-text").value,n=[],a=document.getElementById("save-note-button").getAttribute("data-id");$("input:checkbox[name=edit-tag]:checked").each(function(){n.push($(this).val())}),$.ajax({method:"POST",url:"includes/NoteApi.php",data:{noteText:e,noteId:a,noteTitle:t,noteTags:n,action:"editnote"}}).done(function(i,c){if("1"===i){var s=$('[data-id="'+a+'"]');$(s).children(".note-title")[0].textContent=t,$(s).children(".note-text")[0].textContent=e;var d=$(s).children(".note-text")[0];$(s).find(".note-tags").remove();var l="";n.forEach(function(t,e){l+='<span class="note-tags note-tags-{0}" title="Click to show all notes with this tag." data-tag="{1}">{1}</span>'.format(f,t)}),$(d).after(l),$("#note-edit-modal").modal("hide"),toastr.success("Note successfully updated!")}else o(i)}).fail(function(t){o(t)})}),document.getElementById("tag-chooser").addEventListener("change",function(){var t=this.value;"note_keeper_showall"!==t?d(this.value):($(".note").show(),toastr.info("Showing all notes"))}),$("#search-note-button").on("click",function(){var t=document.getElementById("search-note-text").value;c(t)}),$("#search-note-text").on("keyup",function(t){if(13===t.keyCode){var e=document.getElementById("search-note-text").value;c(e)}}),$("#show-search-button").on("click",function(){document.getElementById("tag-chooser-input").style.display="none",$("#search-input").toggle()}),$("#show-tag-chooser-button").on("click",function(){document.getElementById("search-input").style.display="none",$("#tag-chooser-input").toggle()}),r.on("click","#note-edit-modal",function(){$("#note-edit-modal").show()}),$("#close-new-note").on("click",function(){p.hide()}),$("#notification-close").on("click",function(){$("#system-notification-group").hide()}),$("#add-note-text").on("keyup",function(){$(".note-text-validation").hide()}),$("#edit-note-text").on("keyup",function(){$(".edit-note-text-validation").hide()}),$("#add-new-tag-text").on("keyup",function(t){13===t.keyCode&&s("#add-note-tags","#add-new-tag-text",2)}),$("#edit-new-tag-text").on("keyup",function(t){13===t.keyCode&&s("#edit-note-tags","#edit-new-tag-text",1)}),$("#refresh-button").on("click",function(){document.getElementById("note-list").innerHTML="";for(var t=document.getElementsByClassName("checkbox"),e=t.length,n=0;n<e;n++){var o=t[0].parentNode;o.removeChild(t[0])}a(k)})}();