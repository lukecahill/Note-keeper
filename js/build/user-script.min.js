!function(){function e(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}function o(){$.ajax({method:"POST",url:"includes/user-settings.php",data:{id:userId,action:"get-settings"}}).done(function(e,o){e=JSON.parse(e);var n=e[0],r=e[1],t=$("#select-tag-color"),a=t.find("option[value={0}]".format(n));a.remove(),t.find("option:eq(0)").before(a),$("#select-tag-color > option:eq(0)").attr("selected",!0),$noteOrder=$("#options-note-order"),a=$noteOrder.find("option[value={0}]".format(r)),a.remove(),$noteOrder.find("option:eq(0)").before(a),$("#options-note-order > option:eq(0)").attr("selected",!0),"true"===e[2]&&$("#search_title").prop("checked",!0),"true"===e[3]&&$("#search_text").prop("checked",!0),"true"===e[4]&&$("#search_mark_done").prop("checked",!0),$("#total_notes").append(e[5]),e[6].reverse(),u.append("<b>Most Recent</b>"),$.each(e[6],function(e,o){u.append("<p>{0}</p>".format(o))}),"dark"===e[7]&&$("#theme_checkbox").prop("checked",!0),localStorage.setItem("theme",e[7])}).fail(function(e){console.log("An error occurred",e)})}$("#password-change, #search-div, #order-div, #color-div, #recent-ips-div, #theme-div, #maps-div").hide();var n=!1,r=!1,t=!1,a=!1,s=!1,c=!1,d=!1,i=$(".password_span"),l=$(".order_dropdown_span"),p=$(".search_dropdown_span"),h=$(".color_dropdown_span"),u=$("#recent-ips-div"),v=$(".recent_ips_span"),g=$(".theme_dropdown_span"),m=$(".maps_dropdown_span");String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(o,n){return"undefined"!=typeof e[n]?e[n]:o})}),"light"===localStorage.getItem("theme")?($("html").removeClass("dark-theme"),$(".container-fluid.account-dark").removeClass("account-dark")):"dark"===localStorage.getItem("theme")&&($("html").addClass("dark-theme"),$(".container-fluid.account-dark").addClass("account-dark")),o(),$("#tag-color-button").on("click",function(){var e=$("#select-tag-color").val();$.ajax({method:"POST",url:"includes/user-settings.php",data:{color:e,id:userId,action:"set-tag-color"}}).done(function(e,o){toastr.success("Tag color updated!")}).fail(function(e){console.log("An error occurred",e)})}),$("#options-order-button").on("click",function(){var e=$("#options-note-order").val();$.ajax({method:"POST",url:"includes/user-settings.php",data:{id:userId,action:"set-note-order",order:e}}).done(function(e,o){toastr.success("Note order has been successfully updated!")}).fail(function(e){console.log("An error occurred",e)})}),$("#options-search-button").on("click",function(){var e=$("#search_title").is(":checked"),o=$("#search_text").is(":checked"),n=$("#search_mark_done").is(":checked");return e===!1&&o===!1?void alert("You must chose to search by either one or both of title and text!"):void $.ajax({method:"POST",url:"includes/user-settings.php",data:{id:userId,action:"set-search-parameters",text:o,title:e,complete:n}}).done(function(e,o){toastr.success("Search settings updated!")}).fail(function(e){console.log("An error occurred",e)})}),$("#change-password-form").on("submit",function(e){$(".validation-error").remove();var o=$("#new-password").val(),n=$("#confirm-password").val(),r=$("#old-password").val();return confirm("Please confirm you wish to change your password.")?""===r?($("#old-password").after('<span class="validation-error">Please enter your old password!</span>'),void e.preventDefault()):""===o.trim()||""===n.trim()?($("#new-password").after('<span class="validation-error">The new or confirmation input is empty!</span>'),void e.preventDefault()):o!==n?($("#confirm-password").after('<span class="validation-error">The confirmation password is different!</span>'),void e.preventDefault()):void 0:void e.preventDefault()}),$("#theme-button").on("click",function(){var o=$("#theme_checkbox").is(":checked"),n="light";o&&(n="dark"),$.ajax({method:"POST",url:"includes/user-settings.php",data:{action:"set-theme",theme:n,id:userId}}).done(function(o,r){o=JSON.parse(o),"success"===o&&(e?(localStorage.setItem("theme",n),toastr.info("Updated theme settings! Please refresh your page.")):toastr.info("Please log out and back in for changes to take place"))}).fail(function(e){console.log(e)})}),$("#password-header").on("click",function(){$("#password-change").toggle(),n?(i.addClass("glyphicon-chevron-up"),i.removeClass("glyphicon-chevron-down"),n=!1):(i.addClass("glyphicon-chevron-down"),i.removeClass("glyphicon-chevron-up"),n=!0)}),$("#color-header").on("click",function(){$("#color-div").toggle(),r?(h.addClass("glyphicon-chevron-up"),h.removeClass("glyphicon-chevron-down"),r=!1):(h.addClass("glyphicon-chevron-down"),h.removeClass("glyphicon-chevron-up"),r=!0)}),$("#order-header").on("click",function(){$("#order-div").toggle(),t?(l.addClass("glyphicon-chevron-up"),l.removeClass("glyphicon-chevron-down"),t=!1):(l.addClass("glyphicon-chevron-down"),l.removeClass("glyphicon-chevron-up"),t=!0)}),$("#search-header").on("click",function(){$("#search-div").toggle(),a?(p.addClass("glyphicon-chevron-up"),p.removeClass("glyphicon-chevron-down"),a=!1):(p.addClass("glyphicon-chevron-down"),p.removeClass("glyphicon-chevron-up"),a=!0)}),$("#recent-ips-header").on("click",function(){$("#recent-ips-div").toggle(),s?(v.addClass("glyphicon-chevron-up"),v.removeClass("glyphicon-chevron-down"),s=!1):(v.addClass("glyphicon-chevron-down"),v.removeClass("glyphicon-chevron-up"),s=!0)}),$("#theme-header").on("click",function(){$("#theme-div").toggle(),c?(g.addClass("glyphicon-chevron-up"),g.removeClass("glyphicon-chevron-down"),c=!1):(g.addClass("glyphicon-chevron-down"),g.removeClass("glyphicon-chevron-up"),c=!0)}),$("#maps-header").on("click",function(){$("#maps-div").toggle(),d?(m.addClass("glyphicon-chevron-up"),m.removeClass("glyphicon-chevron-down"),d=!1):(m.addClass("glyphicon-chevron-down"),m.removeClass("glyphicon-chevron-up"),d=!0)}),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){console.log(e.coords.latitude,e.coords.longitude);var o=e.coords.longitude,n=e.coords.latitude,r=new Image;r.src="https://maps.googleapis.com/maps/api/staticmap?center="+n+","+o+"&zoom=13&size=300x300&sensor=false",$("#map_location").append(r),$.ajax({url:"includes/user-settings.php",method:"POST",data:{action:"location",latitude:n,longitude:o,id:userId}}).done(function(e){e=JSON.parse(e),"success"===e&&console.log("Saved")}).error(function(e){console.warn("Could not save location")})}):console.warn("Geolocation is not available")}();