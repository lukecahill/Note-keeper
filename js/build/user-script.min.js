!function(){function e(){$.ajax({method:"POST",url:"includes/user-settings.php",data:{id:userId,action:"get-settings"}}).done(function(e,n){e=JSON.parse(e),o(e)}).fail(function(e){console.log("An error occurred",e)})}function o(e){var o=e[0],n=e[1],t=$("#select-tag-color"),r=t.find("option[value={0}]".format(o));r.remove(),t.find("option:eq(0)").before(r),$("#select-tag-color > option:eq(0)").attr("selected",!0),$noteOrder=$("#options-note-order"),r=$noteOrder.find("option[value={0}]".format(n)),r.remove(),$noteOrder.find("option:eq(0)").before(r),$("#options-note-order > option:eq(0)").attr("selected",!0),"true"===e[2]&&(document.getElementById("search_title").checked=!0),"true"===e[3]&&(document.getElementById("search_text").checked=!0),"true"===e[4]&&(document.getElementById("search_mark_done").checked=!0),$("#total_notes").append(e[5]),e[6].reverse(),v.append("<b>Most Recent</b>"),e[6].forEach(function(e,o){v.append("<p>{0}</p>".format(e))}),"dark"===e[7]&&(document.getElementById("theme_checkbox").checked=!0),localStorage.setItem("theme",e[7])}function n(e,o){$.ajax({url:"includes/user-settings.php",method:"POST",data:{action:"location",latitude:e,longitude:o,id:userId}}).done(function(e){e=JSON.parse(e),"success"===e&&console.log("Saved")}).error(function(e){console.warn("Could not save location")})}$("#password-change, #search-div, #order-div, #color-div, #recent-ips-div, #theme-div, #maps-div, #share-div").hide();var t=!1,r=!1,a=!1,c=!1,s=!1,d=!1,l=!1,i=!1,h=$(".password_span"),u=$(".order_dropdown_span"),p=$(".search_dropdown_span"),g=$(".color_dropdown_span"),v=$("#recent-ips-div"),m=$(".recent_ips_span"),f=$(".theme_dropdown_span"),y=$(".maps_dropdown_span"),w=$(".share_dropdown_span");if(localStorageTest()&&("light"===localStorage.getItem("theme")?($("html").removeClass("dark-theme"),$(".container-fluid.account-dark").removeClass("account-dark")):"dark"===localStorage.getItem("theme")&&($("html").addClass("dark-theme"),$(".container-fluid.account-dark").addClass("account-dark"))),e(),$("#tag-color-button").on("click",function(){var e=$("#select-tag-color").val();$.ajax({method:"POST",url:"includes/user-settings.php",data:{color:e,id:userId,action:"set-tag-color"}}).done(function(e,o){toastr.success("Tag color updated!")}).fail(function(e){console.log("An error occurred",e)})}),$("#options-order-button").on("click",function(){var e=$("#options-note-order").val();$.ajax({method:"POST",url:"includes/user-settings.php",data:{id:userId,action:"set-note-order",order:e}}).done(function(e,o){toastr.success("Note order has been successfully updated!")}).fail(function(e){console.log("An error occurred",e)})}),$("#options-search-button").on("click",function(){var e=document.getElementById("search_title").checked,o=document.getElementById("search_text").checked,n=document.getElementById("search_mark_done").checked;return e===!1&&o===!1?void alert("You must chose to search by either one or both of title and text!"):void $.ajax({method:"POST",url:"includes/user-settings.php",data:{id:userId,action:"set-search-parameters",text:o,title:e,complete:n}}).done(function(e,o){toastr.success("Search settings updated!")}).fail(function(e){console.log("An error occurred",e)})}),$("#change-password-form").on("submit",function(e){$(".validation-error").remove();var o=document.getElementById("new-password").value,n=document.getElementById("confirm-password").value,t=document.getElementById("old-password").value;return confirm("Please confirm you wish to change your password.")?""===t?($("#old-password").after('<span class="validation-error">Please enter your old password!</span>'),void e.preventDefault()):""===o.trim()||""===n.trim()?($("#new-password").after('<span class="validation-error">The new or confirmation input is empty!</span>'),void e.preventDefault()):o!==n?($("#confirm-password").after('<span class="validation-error">The confirmation password is different!</span>'),void e.preventDefault()):void 0:void e.preventDefault()}),$("#theme-button").on("click",function(){var e=document.getElementById("theme_checkbox").checked,o="light";e&&(o="dark"),$.ajax({method:"POST",url:"includes/user-settings.php",data:{action:"set-theme",theme:o,id:userId}}).done(function(e,n){e=JSON.parse(e),"success"===e&&(localStorageTest?(localStorage.setItem("theme",o),toastr.info("Updated theme settings! Please refresh your page.")):toastr.info("Please log out and back in for changes to take place"))}).fail(function(e){console.log(e)})}),$("#password-header").on("click",function(){$("#password-change").toggle(),t?(h.addClass("glyphicon-chevron-up"),h.removeClass("glyphicon-chevron-down"),t=!1):(h.addClass("glyphicon-chevron-down"),h.removeClass("glyphicon-chevron-up"),t=!0)}),$("#color-header").on("click",function(){$("#color-div").toggle(),r?(g.addClass("glyphicon-chevron-up"),g.removeClass("glyphicon-chevron-down"),r=!1):(g.addClass("glyphicon-chevron-down"),g.removeClass("glyphicon-chevron-up"),r=!0)}),$("#order-header").on("click",function(){$("#order-div").toggle(),a?(u.addClass("glyphicon-chevron-up"),u.removeClass("glyphicon-chevron-down"),a=!1):(u.addClass("glyphicon-chevron-down"),u.removeClass("glyphicon-chevron-up"),a=!0)}),$("#search-header").on("click",function(){$("#search-div").toggle(),c?(p.addClass("glyphicon-chevron-up"),p.removeClass("glyphicon-chevron-down"),c=!1):(p.addClass("glyphicon-chevron-down"),p.removeClass("glyphicon-chevron-up"),c=!0)}),$("#recent-ips-header").on("click",function(){$("#recent-ips-div").toggle(),s?(m.addClass("glyphicon-chevron-up"),m.removeClass("glyphicon-chevron-down"),s=!1):(m.addClass("glyphicon-chevron-down"),m.removeClass("glyphicon-chevron-up"),s=!0)}),$("#theme-header").on("click",function(){$("#theme-div").toggle(),d?(f.addClass("glyphicon-chevron-up"),f.removeClass("glyphicon-chevron-down"),d=!1):(f.addClass("glyphicon-chevron-down"),f.removeClass("glyphicon-chevron-up"),d=!0)}),$("#maps-header").on("click",function(){$("#maps-div").toggle(),l?(y.addClass("glyphicon-chevron-up"),y.removeClass("glyphicon-chevron-down"),l=!1):(y.addClass("glyphicon-chevron-down"),y.removeClass("glyphicon-chevron-up"),l=!0)}),$("#share-header").on("click",function(){$("#share-div").toggle(),i?(w.addClass("glyphicon-chevron-up"),w.removeClass("glyphicon-chevron-down"),i=!1):(w.addClass("glyphicon-chevron-down"),w.removeClass("glyphicon-chevron-up"),i=!0)}),"geolocation"in navigator){var C=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase());if("https:"!==location.protocol&&C)return console.warn("Geolocation cannot be used on insecure domains using Chrome"),void $("#map_location").html('<p class="error">Geolocation cannot be used on insecure HTTP using Chrome!</p>');navigator.geolocation.getCurrentPosition(function(e){console.log(e.coords.latitude,e.coords.longitude);var o=e.coords.longitude,t=e.coords.latitude;n(t,o)})}else console.warn("Geolocation is not available");$("#share-button").on("click",function(){document.getElementById("user_email").value})}();